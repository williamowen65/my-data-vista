<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Observation Hub</title>
    <script src="/home/index.js"></script>
    <style>
      body, html {
        margin: 0;
        overflow: hidden;
        touch-action: none;
      }
      .layer-ui_wrapper {
        position: absolute;
        width: 100%;
        height: 100%;
        
      }

      #svg-root {
        position: absolute;
        width: 100vw;
        height: 100vh;
        background-color: #f0f0f0;
      }
    </style>

   
  </head>
  <body>
 
     <!-- TODO Create head-component -->
     <div id="my-observation-hub-app">
        <div class="layer-ui_wrapper">
          <!-- All of these Items are position absolute -->
          <div id="welcome-screen"></div>
          <div id="menu-top">
            <div id="dropdown-menu"></div>
          </div>
          <footer id="menu-bottom"></footer>
        </div>
  
        <svg id="svg-root" viewBox="-500 -500 1000 1000" preserveAspectRatio="xMidYMid meet">
          <!-- Example Shapes -->
          <rect x="-50" y="-50" width="100" height="100" fill="red"/>
          <circle cx="0" cy="0" r="50" fill="blue"/>
      </svg>
      </div>

      <script>
        const svg = document.getElementById("svg-root");

        let viewBox = { x: -500, y: -500, width: 1000, height: 1000 };
        let isPanning = false, startX, startY, startViewBoxX, startViewBoxY;
        let zoomFactor = 1.1; // Zoom speed
        let touchDistance = null; // Distance between fingers for pinch zoom

        function updateViewBox() {
            svg.setAttribute("viewBox", `${viewBox.x} ${viewBox.y} ${viewBox.width} ${viewBox.height}`);
        }

        // Mouse down to start panning
        svg.addEventListener("mousedown", (e) => {
            isPanning = true;
            startX = e.clientX;
            startY = e.clientY;
            startViewBoxX = viewBox.x;
            startViewBoxY = viewBox.y;
            svg.style.cursor = "grabbing";
        });

        // Mouse move to pan
        svg.addEventListener("mousemove", (e) => {
            if (!isPanning) return;
            let dx = (e.clientX - startX) * (viewBox.width / window.innerWidth);
            let dy = (e.clientY - startY) * (viewBox.height / window.innerHeight);
            viewBox.x = startViewBoxX - dx;
            viewBox.y = startViewBoxY - dy;
            updateViewBox();
        });

        // Mouse up to stop panning
        svg.addEventListener("mouseup", () => {
            isPanning = false;
            svg.style.cursor = "grab";
        });

        svg.addEventListener("mouseleave", () => {
            isPanning = false;
            svg.style.cursor = "grab";
        });

        // Zoom with mouse wheel
        svg.addEventListener("wheel", (e) => {
            e.preventDefault();
            let zoom = e.deltaY < 0 ? 1 / zoomFactor : zoomFactor;
            let mouseX = e.clientX / window.innerWidth;
            let mouseY = e.clientY / window.innerHeight;

            let newWidth = viewBox.width * zoom;
            let newHeight = viewBox.height * zoom;

            viewBox.x += (viewBox.width - newWidth) * mouseX;
            viewBox.y += (viewBox.height - newHeight) * mouseY;
            viewBox.width = newWidth;
            viewBox.height = newHeight;

            updateViewBox();
        });

        // Handle touch events
        svg.addEventListener("touchstart", (e) => {
            if (e.touches.length === 1) {
                // Single finger touch (pan)
                isPanning = true;
                startX = e.touches[0].clientX;
                startY = e.touches[0].clientY;
                startViewBoxX = viewBox.x;
                startViewBoxY = viewBox.y;
            } else if (e.touches.length === 2) {
                // Two fingers (pinch zoom)
                touchDistance = getDistance(e.touches[0], e.touches[1]);
            }
        });

        svg.addEventListener("touchmove", (e) => {
            if (e.touches.length === 1 && isPanning) {
                // Pan
                let dx = (e.touches[0].clientX - startX) * (viewBox.width / window.innerWidth);
                let dy = (e.touches[0].clientY - startY) * (viewBox.height / window.innerHeight);
                viewBox.x = startViewBoxX - dx;
                viewBox.y = startViewBoxY - dy;
                updateViewBox();
            } else if (e.touches.length === 2 && touchDistance !== null) {
                // Pinch Zoom
                let newDistance = getDistance(e.touches[0], e.touches[1]);
                let zoom = touchDistance / newDistance; // Zoom ratio

                let centerX = (e.touches[0].clientX + e.touches[1].clientX) / 2 / window.innerWidth;
                let centerY = (e.touches[0].clientY + e.touches[1].clientY) / 2 / window.innerHeight;

                let newWidth = viewBox.width * zoom;
                let newHeight = viewBox.height * zoom;

                viewBox.x += (viewBox.width - newWidth) * centerX;
                viewBox.y += (viewBox.height - newHeight) * centerY;
                viewBox.width = newWidth;
                viewBox.height = newHeight;

                touchDistance = newDistance;
                updateViewBox();
            }
        });

        svg.addEventListener("touchend", () => {
            isPanning = false;
            touchDistance = null;
        });

        // Helper function to calculate distance between two touch points
        function getDistance(touch1, touch2) {
            let dx = touch2.clientX - touch1.clientX;
            let dy = touch2.clientY - touch1.clientY;
            return Math.sqrt(dx * dx + dy * dy);
        }
    </script>
  </body>
</html>
